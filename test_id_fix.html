<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тест исправления ID</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        button { padding: 10px 20px; margin: 10px; cursor: pointer; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; overflow: auto; font-size: 12px; }
    </style>
</head>
<body>
    <h1>Тест исправления форматов ID</h1>
    
    <div class="test">
        <h3>1. Проверка генерации правильных ID</h3>
        <button onclick="testIDGeneration()">Запустить тест</button>
        <div id="test1Result"></div>
    </div>
    
    <div class="test">
        <h3>2. Пример правильного формата JSON</h3>
        <div id="example"></div>
    </div>
    
    <div class="test">
        <h3>3. Перейти к исправленному редактору</h3>
        <p>Исправленный редактор использует правильные форматы ID:</p>
        <ul>
            <li>Действия: a00001, a00002, ...</li>
            <li>Объекты: o00001, o00002, ...</li>
            <li>Состояния: s00001, s00002, ...</li>
            <li>Объект+Состояние: o00001s00001</li>
        </ul>
        <button onclick="window.open('proxy-index-fixed.html', '_blank')">Открыть исправленный редактор</button>
    </div>
    
    <script>
        function testIDGeneration() {
            const resultDiv = document.getElementById('test1Result');
            resultDiv.innerHTML = '';
            
            // Тестируем генерацию ID
            let actionCounter = 1;
            let objectCounter = 1;
            let stateCounter = 1;
            
            const testIDs = {
                actions: [],
                objects: [],
                states: [],
                combined: []
            };
            
            // Генерируем тестовые ID
            for (let i = 0; i < 3; i++) {
                testIDs.actions.push(`a${(actionCounter + i).toString().padStart(5, '0')}`);
                testIDs.objects.push(`o${(objectCounter + i).toString().padStart(5, '0')}`);
                testIDs.states.push(`s${(stateCounter + i).toString().padStart(5, '0')}`);
                testIDs.combined.push(`o${(objectCounter + i).toString().padStart(5, '0')}s${(stateCounter + i).toString().padStart(5, '0')}`);
            }
            
            let html = '<h4>Сгенерированные ID:</h4>';
            html += '<ul>';
            html += `<li>Действия: ${testIDs.actions.join(', ')}</li>`;
            html += `<li>Объекты: ${testIDs.objects.join(', ')}</li>`;
            html += `<li>Состояния: ${testIDs.states.join(', ')}</li>`;
            html += `<li>Объект+Состояние: ${testIDs.combined.join(', ')}</li>`;
            html += '</ul>';
            
            // Проверяем форматы
            const actionRegex = /^a\d{5}$/;
            const objectRegex = /^o\d{5}$/;
            const stateRegex = /^s\d{5}$/;
            const combinedRegex = /^o\d{5}s\d{5}$/;
            
            const allActionsValid = testIDs.actions.every(id => actionRegex.test(id));
            const allObjectsValid = testIDs.objects.every(id => objectRegex.test(id));
            const allStatesValid = testIDs.states.every(id => stateRegex.test(id));
            const allCombinedValid = testIDs.combined.every(id => combinedRegex.test(id));
            
            const allValid = allActionsValid && allObjectsValid && allStatesValid && allCombinedValid;
            
            if (allValid) {
                html += '<p class="success">✅ Все ID имеют правильный формат!</p>';
                document.querySelector('.test').classList.add('success');
            } else {
                html += '<p class="error">❌ Некоторые ID имеют неправильный формат!</p>';
                document.querySelector('.test').classList.add('error');
            }
            
            resultDiv.innerHTML = html;
        }
        
        // Показываем пример правильного формата
        document.getElementById('example').innerHTML = `
            <pre>{
  "model_actions": [
    {
      "action_id": "a00001",
      "action_name": "Регистрация пользователя",
      "action_links": {
        "manual": "",
        "API": "",
        "UI": ""
      }
    }
  ],
  "model_objects": [
    {
      "object_id": "o00001",
      "object_name": "Пользователь",
      "resource_state": [
        {
          "state_id": "s00001",
          "state_name": "неактивен"
        },
        {
          "state_id": "s00002",
          "state_name": "активен"
        }
      ],
      "object_links": {
        "manual": "",
        "API": "",
        "UI": ""
      }
    }
  ],
  "model_connections": [
    {
      "connection_out": "o00001s00001",
      "connection_in": "a00001"
    },
    {
      "connection_out": "a00001",
      "connection_in": "o00001s00002"
    }
  ]
}</pre>
        `;
        
        // Автозапуск теста
        window.onload = function() {
            setTimeout(testIDGeneration, 500);
        };
    </script>
</body>
</html>