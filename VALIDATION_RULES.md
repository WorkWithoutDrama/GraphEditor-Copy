# Правила валидации модели

## Обновленные правила (после исправлений)

### 1. Структура модели должна содержать:
- `model_actions` - массив действий
- `model_objects` - массив объектов  
- `model_connections` - массив связей

### 2. Форматы идентификаторов:
- `object_id`: `"o" + 5 цифр` (пример: `"o12345"`)
- `state_id`: `"s" + 5 цифр` (пример: `"s00000"`, `"s12345"`)
- `action_id`: любая строка (обычно `"a" + цифры`)

### 3. Обязательные поля для действий:
```json
{
  "action_id": "a1234567890123",
  "action_name": "Название действия",
  "action_links": {
    "manual": "",
    "API": "", 
    "UI": ""
  }
}
```

### 4. Обязательные поля для объектов:
```json
{
  "object_id": "o12345",
  "object_name": "Название объекта",
  "resource_state": [
    {"state_id": "s00000", "state_name": "null"},
    {"state_id": "s12345", "state_name": "активен"}
  ],
  "object_links": {
    "manual": "",
    "API": "",
    "UI": ""
  }
}
```

### 5. Правила для связей:
```json
{
  "connection_out": "a1234567890123",
  "connection_in": "o12345s12345"
}
```

**Важно**: `connection_in` использует составной ID: `object_id + state_id` (например, `"o12345s12345"`)

## Ключевые изменения:

### 1. **`action_links` и `object_links` теперь обязательны**, но могут содержать пустые строки:
- Раньше: поля были необязательными
- Сейчас: поля обязательны, но значения могут быть `""` (пустая строка)

### 2. **Составные ID для состояний**:
- Состояния в `model_connections` используют составной ID: `object_id + state_id`
- Пример: `"o12345" + "s12345" = "o12345s12345"`

### 3. **Проверка существования узлов**:
- При создании связей проверяется существование обоих узлов
- Если узел отсутствует, он создается автоматически (для составных ID состояний)

## Пример правильной модели:

```json
{
  "model_actions": [
    {
      "action_id": "a1234567890123",
      "action_name": "Проверить email",
      "action_links": {
        "manual": "",
        "API": "",
        "UI": ""
      }
    }
  ],
  "model_objects": [
    {
      "object_id": "o12345",
      "object_name": "Пользователь",
      "resource_state": [
        {"state_id": "s00000", "state_name": "null"},
        {"state_id": "s12345", "state_name": "зарегистрирован"}
      ],
      "object_links": {
        "manual": "",
        "API": "",
        "UI": ""
      }
    }
  ],
  "model_connections": [
    {
      "connection_out": "a1234567890123",
      "connection_in": "o12345s12345"
    }
  ]
}
```

## Промпт для LLM обновлен:

В промпте теперь явно указано:
1. `action_links` и `object_links` обязательны
2. Должны содержать ключи: `manual`, `API`, `UI`
3. Значения могут быть пустыми строками `""`

## Тестирование:

Для проверки созданы тесты:
1. `test_validation.py` - проверка валидации
2. `test-fix.html` - проверка логики составных ID
3. `FIXES_APPLIED.md` - документация по исправлениям

## Запуск тестов:

```bash
# Проверка валидации
python3 test_validation.py

# Проверка логики (откройте в браузере)
open test-fix.html
```