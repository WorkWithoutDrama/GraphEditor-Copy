<!DOCTYPE html>
<html>
<head>
    <title>Graph Editor (via Proxy)</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.23.0/cytoscape.min.js"></script>
    <script src="https://unpkg.com/dagre@0.8.5/dist/dagre.min.js"></script>
    <script src="https://unpkg.com/cytoscape-dagre@2.5.0/cytoscape-dagre.js"></script>
</head>
<body>

    <div class="controls">
        <button id="loadButton" class="primary">–í—ã–±—Ä–∞—Ç—å –ø—Ä–æ–µ–∫—Ç</button>
        <input type="file" id="fileInput" accept=".json" style="display: none;">
        <button id="saveButton" class="primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–µ–∫—Ç</button>
        <button id="addActionButton">–î–æ–±–∞–≤–∏—Ç—å –î–µ–π—Å—Ç–≤–∏–µ</button>
        <button id="addStateButton">–î–æ–±–∞–≤–∏—Ç—å –û–±—ä–µ–∫—Ç</button>
        <button id="addLinkButton" class="success">+ –°–≤—è–∑—å (1 ‚Üí 2)</button>
        <button id="removeLinkButton" class="danger">- –°–≤—è–∑—å</button>
        <button id="deleteSelectedButton" class="danger">–£–¥–∞–ª–∏—Ç—å (Del)</button>
        <button id="runLayoutButton">–û–±–Ω–æ–≤–∏—Ç—å –∫–æ–º–ø–æ–Ω–æ–≤–∫—É</button>
        <button id="graphManagerButton" class="primary">Graph Manager</button>
        <button id="testManagerButton" class="primary">Test Manager</button>
        <span class="hint">–°–Ω–∞—á–∞–ª–∞ –∫–ª–∏–∫ –Ω–∞ <b>–ò—Å—Ç–æ—á–Ω–∏–∫</b>, –∑–∞—Ç–µ–º –Ω–∞ <b>–¶–µ–ª—å</b>.</span>
    </div>

    <div class="main-container">
        <div id="cy"></div>
        
        <div class="resizer" id="resizer"></div>
        
        <div class="chat-container" id="chatContainer" style="display: none;">
            <div class="chat-header">
                <h3>Graph Manager</h3>
                <div class="chat-header-buttons">
                    <button class="header-btn" id="llmProviderBtn" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞">ü§ñ LLM</button>
                    <button class="header-btn" id="clearChatBtn" title="–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é">üóëÔ∏è</button>
                    <button class="close-btn" id="closeChatBtn">√ó</button>
                </div>
            </div>
            <div class="chat-messages" id="chatMessages">
                <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ -->
            </div>
            <div class="chat-input-container">
                <textarea id="chatInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª..."></textarea>
                <div class="chat-actions">
                    <input type="file" id="fileUpload" accept=".txt,.md,.pdf" style="display: none;">
                    <button id="uploadFileBtn" class="secondary">üìé –§–∞–π–ª</button>
                    <button id="sendMessageBtn" class="primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                </div>
            </div>
        </div>

        <div class="chat-container" id="testManagerContainer" style="display: none;">
            <div class="chat-header">
                <h3>Test Manager</h3>
                <div class="chat-header-buttons">
                    <button class="header-btn" id="clearTestChatBtn" title="–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é">üóëÔ∏è</button>
                    <button class="close-btn" id="closeTestChatBtn">√ó</button>
                </div>
            </div>
            <div class="chat-messages" id="testMessages">
                <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ -->
            </div>
            <div class="test-manager-actions">
                <div class="test-buttons-container">
                    <button id="allTestsBtn" class="primary">–í—Å–µ —Ç–µ—Å—Ç—ã</button>
                    <button id="actionTestsBtn" class="primary">–¢–µ—Å—Ç—ã –¥–ª—è –¥–µ–π—Å—Ç–≤–∏—è</button>
                </div>
                <div class="test-results" id="testResults">
                    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
                </div>
            </div>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–∫—Ä–∏–ø—Ç—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø—É—Ç—è–º–∏ -->
    <script>
        // –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—É—Ç–µ–π
        window.API_BASE_URL = 'http://localhost:3000';
    </script>
    <script src="script_fixed.js"></script>
    <script src="graph-manager.js"></script>
    <script src="test-manager.js"></script>

    <script>
        // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
        window.addEventListener('DOMContentLoaded', () => {
            if (typeof window.GraphManager === 'undefined') {
                console.error('‚ùå GraphManager –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω!');
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ GraphManager. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞.');
            } else {
                console.log('‚úÖ GraphManager –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ');
            }

            if (typeof window.TestManager === 'undefined') {
                console.error('‚ùå TestManager –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω!');
            } else {
                console.log('‚úÖ TestManager –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ');
            }
        });
    </script>
</body>
</html>