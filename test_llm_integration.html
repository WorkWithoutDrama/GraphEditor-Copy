<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ LLM</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        button { padding: 10px 20px; margin: 10px; cursor: pointer; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; overflow: auto; font-size: 12px; }
        .log { font-family: monospace; white-space: pre-wrap; background: #f8f9fa; padding: 10px; border-radius: 5px; max-height: 400px; overflow-y: auto; }
        .status { padding: 5px 10px; border-radius: 3px; display: inline-block; }
        .status-ok { background: #28a745; color: white; }
        .status-error { background: #dc3545; color: white; }
        .status-warning { background: #ffc107; color: black; }
    </style>
</head>
<body>
    <h1>–¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ LLM –≤ —Å–∏—Å—Ç–µ–º—É</h1>
    
    <div class="test-section">
        <h3>1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ LLM (Ollama)</h3>
        <button onclick="checkLLM()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å LLM</button>
        <div id="llmStatus">
            <p>–°—Ç–∞—Ç—É—Å: <span class="status" id="statusIndicator">–ù–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ</span></p>
        </div>
        <div id="llmDetails"></div>
    </div>
    
    <div class="test-section">
        <h3>2. –¢–µ—Å—Ç API –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–æ–¥–µ–ª–∏</h3>
        <button onclick="testAPIGeneration()">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</button>
        <div id="apiTestResult"></div>
    </div>
    
    <div class="test-section">
        <h3>3. –î–µ—Ç–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç —Å –ø—Ä–æ–º–ø—Ç–æ–º</h3>
        <textarea id="testText" rows="5" style="width: 100%; margin-bottom: 10px;">
–¢–ï–•–ù–ò–ß–ï–°–ö–û–ï –ó–ê–î–ê–ù–ò–ï (–¢–ó) –Ω–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –∫–ª–∏–µ–Ω—Ç-—Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è "Mindful Meals"

1. –û–ë–©–ò–ï –°–í–ï–î–ï–ù–ò–Ø
1.1. –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞: Mindful Meals (–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø–∏—Ç–∞–Ω–∏—è)
1.2. –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∑–¥–æ—Ä–æ–≤–æ–≥–æ –ø–∏—Ç–∞–Ω–∏—è.

2. –¢–†–ï–ë–û–í–ê–ù–ò–Ø –ö –§–£–ù–ö–¶–ò–û–ù–ê–õ–£
2.1. –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å (Frontend)
    2.1.1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:
        * –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ email/–ø–∞—Ä–æ–ª—é.
        * –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è.
    2.1.2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ü—Ä–æ—Ñ–∏–ª—è:
        * –í–≤–æ–¥ –ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö: –ø–æ–ª, –≤–æ–∑—Ä–∞—Å—Ç, —Ä–æ—Å—Ç, –≤–µ—Å.
        * –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–µ–ª–∏: –ø–æ—Ö—É–¥–µ–Ω–∏–µ, –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ, –Ω–∞–±–æ—Ä –º–∞—Å—Å—ã.
    2.1.3. –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ü–∏—Ç–∞–Ω–∏—è:
        * –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ–¥–µ–ª—å–Ω–æ–≥–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—è.
        * –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–µ–º–æ–≤ –ø–∏—â–∏.
        </textarea>
        <button onclick="testWithDetailedPrompt()">–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –ø—Ä–æ–º–ø—Ç–æ–º</button>
        <div id="detailedTestResult"></div>
    </div>
    
    <div class="test-section">
        <h3>4. –õ–æ–≥–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
        <div id="log" class="log"></div>
    </div>
    
    <script>
        const logElement = document.getElementById('log');
        const statusIndicator = document.getElementById('statusIndicator');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const typeClass = type === 'error' ? 'status-error' : type === 'success' ? 'status-ok' : 'status-warning';
            const typeIcon = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : 'üîç';
            
            logElement.innerHTML += `<div>${typeIcon} [${timestamp}] ${message}</div>`;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function updateStatus(text, type = 'info') {
            statusIndicator.textContent = text;
            statusIndicator.className = 'status ' + 
                (type === 'success' ? 'status-ok' : 
                 type === 'error' ? 'status-error' : 'status-warning');
        }
        
        async function checkLLM() {
            log('üîç –ü—Ä–æ–≤–µ—Ä—è—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å LLM (Ollama)...');
            updateStatus('–ü—Ä–æ–≤–µ—Ä–∫–∞...', 'warning');
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º API –∑–¥–æ—Ä–æ–≤—å—è
                const healthResponse = await fetch('http://localhost:5003/api/health');
                if (!healthResponse.ok) {
                    throw new Error(`API –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç: ${healthResponse.status}`);
                }
                
                const healthData = await healthResponse.json();
                log(`‚úÖ API –æ—Ç–≤–µ—á–∞–µ—Ç: ${JSON.stringify(healthData)}`, 'success');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º LLM —Å—Ç–∞—Ç—É—Å
                if (healthData.llm_available) {
                    log(`ü§ñ LLM –¥–æ—Å—Ç—É–ø–µ–Ω: ${healthData.llm_status}`, 'success');
                    updateStatus(`LLM –¥–æ—Å—Ç—É–ø–µ–Ω: ${healthData.llm_status}`, 'success');
                    
                    document.getElementById('llmDetails').innerHTML = `
                        <div class="success">
                            <p>‚úÖ LLM –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å —Å–∏—Å—Ç–µ–º–æ–π!</p>
                            <p>–°—Ç–∞—Ç—É—Å: ${healthData.llm_status}</p>
                            <p>API: ${healthData.api}</p>
                        </div>
                    `;
                } else {
                    log(`‚ö†Ô∏è LLM –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ${healthData.llm_status}`, 'warning');
                    updateStatus(`LLM –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ${healthData.llm_status}`, 'warning');
                    
                    document.getElementById('llmDetails').innerHTML = `
                        <div class="warning">
                            <p>‚ö†Ô∏è LLM –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</p>
                            <p>–°—Ç–∞—Ç—É—Å: ${healthData.llm_status}</p>
                            <p>–°–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞</p>
                        </div>
                    `;
                }
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ LLM: ${error.message}`, 'error');
                updateStatus(`–û—à–∏–±–∫–∞: ${error.message}`, 'error');
                
                document.getElementById('llmDetails').innerHTML = `
                    <div class="error">
                        <p>‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å LLM</p>
                        <p>–û—à–∏–±–∫–∞: ${error.message}</p>
                        <p>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ API —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω</p>
                    </div>
                `;
            }
        }
        
        async function testAPIGeneration() {
            log('üîç –¢–µ—Å—Ç–∏—Ä—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –º–æ–¥–µ–ª–∏ —á–µ—Ä–µ–∑ API...');
            
            const testText = "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–∏—Å—Ç–µ–º–µ. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç email –∏ –ø–∞—Ä–æ–ª—å. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏ —Å–æ–∑–¥–∞–µ—Ç —É—á–µ—Ç–Ω—É—é –∑–∞–ø–∏—Å—å.";
            
            try {
                const response = await fetch('http://localhost:5003/api/generate-model', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: testText })
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP –æ—à–∏–±–∫–∞: ${response.status} - ${errorText}`);
                }
                
                const data = await response.json();
                
                log(`‚úÖ API –æ—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω`, 'success');
                log(`üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–æ–¥–µ–ª–∏:`, 'success');
                log(`   –î–µ–π—Å—Ç–≤–∏–π: ${data.model?.model_actions?.length || 0}`, 'success');
                log(`   –û–±—ä–µ–∫—Ç–æ–≤: ${data.model?.model_objects?.length || 0}`, 'success');
                log(`   –°–≤—è–∑–µ–π: ${data.model?.model_connections?.length || 0}`, 'success');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞—á–µ—Å—Ç–≤–æ –º–æ–¥–µ–ª–∏
                const hasLLM = data.model?.model_objects?.length > 1 || 
                              data.model?.model_actions?.some(a => !a.action_name.includes('–∏–∑ –¢–ó'));
                
                document.getElementById('apiTestResult').innerHTML = `
                    <div class="${hasLLM ? 'success' : 'warning'}">
                        <p>${hasLLM ? '‚úÖ' : '‚ö†Ô∏è'} –ú–æ–¥–µ–ª—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞ ${hasLLM ? '—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º LLM' : '—Å —É–ø—Ä–æ—â–µ–Ω–Ω—ã–º –∞–Ω–∞–ª–∏–∑–æ–º'}</p>
                        <p>–î–µ–π—Å—Ç–≤–∏–π: ${data.model?.model_actions?.length || 0}</p>
                        <p>–û–±—ä–µ–∫—Ç–æ–≤: ${data.model?.model_objects?.length || 0}</p>
                        <p>–°–≤—è–∑–µ–π: ${data.model?.model_connections?.length || 0}</p>
                        <button onclick="showModelDetails()">–ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–µ–ª—å</button>
                        <div id="modelDetails" style="display: none; margin-top: 10px;">
                            <pre>${JSON.stringify(data.model, null, 2)}</pre>
                        </div>
                    </div>
                `;
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ API: ${error.message}`, 'error');
                
                document.getElementById('apiTestResult').innerHTML = `
                    <div class="error">
                        <p>‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–æ–¥–µ–ª–∏</p>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        function showModelDetails() {
            const detailsDiv = document.getElementById('modelDetails');
            detailsDiv.style.display = detailsDiv.style.display === 'none' ? 'block' : 'none';
        }
        
        async function testWithDetailedPrompt() {
            const testText = document.getElementById('testText').value;
            log('üîç –¢–µ—Å—Ç–∏—Ä—É—é —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –ø—Ä–æ–º–ø—Ç–æ–º...');
            log(`üìÑ –¢–µ–∫—Å—Ç –¢–ó (${testText.length} —Å–∏–º–≤–æ–ª–æ–≤): ${testText.substring(0, 100)}...`);
            
            try {
                const startTime = Date.now();
                const response = await fetch('http://localhost:5003/api/generate-model', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: testText })
                });
                
                const endTime = Date.now();
                log(`‚è±Ô∏è –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ${endTime - startTime}ms`);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP –æ—à–∏–±–∫–∞: ${response.status} - ${errorText}`);
                }
                
                const data = await response.json();
                
                // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç
                const model = data.model;
                const actionNames = model?.model_actions?.map(a => a.action_name) || [];
                const objectNames = model?.model_objects?.map(o => o.object_name) || [];
                
                log(`‚úÖ –ú–æ–¥–µ–ª—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞ –∑–∞ ${endTime - startTime}ms`, 'success');
                log(`üìä –î–µ—Ç–∞–ª–∏:`, 'success');
                log(`   ‚Ä¢ –î–µ–π—Å—Ç–≤–∏–π: ${actionNames.length}`, 'success');
                log(`   ‚Ä¢ –û–±—ä–µ–∫—Ç–æ–≤: ${objectNames.length}`, 'success');
                log(`   ‚Ä¢ –°–≤—è–∑–µ–π: ${model?.model_connections?.length || 0}`, 'success');
                
                if (actionNames.length > 0) {
                    log(`   ‚Ä¢ –ü—Ä–∏–º–µ—Ä—ã –¥–µ–π—Å—Ç–≤–∏–π: ${actionNames.slice(0, 3).join(', ')}`, 'success');
                }
                if (objectNames.length > 0) {
                    log(`   ‚Ä¢ –ü—Ä–∏–º–µ—Ä—ã –æ–±—ä–µ–∫—Ç–æ–≤: ${objectNames.slice(0, 3).join(', ')}`, 'success');
                }
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –ª–∏ LLM
                const usesLLM = actionNames.length > 3 || 
                               objectNames.length > 1 ||
                               actionNames.some(name => name.length > 20 && !name.includes('–∏–∑ –¢–ó'));
                
                document.getElementById('detailedTestResult').innerHTML = `
                    <div class="${usesLLM ? 'success' : 'warning'}">
                        <h4>${usesLLM ? '‚úÖ LLM –ë–´–õ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù' : '‚ö†Ô∏è –ò–°–ü–û–õ–¨–ó–û–í–ê–ù –£–ü–†–û–©–ï–ù–ù–´–ô –ê–ù–ê–õ–ò–ó'}</h4>
                        <p>–í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: ${endTime - startTime}ms</p>
                        <p>–î–µ–π—Å—Ç–≤–∏–π: ${actionNames.length}</p>
                        <p>–û–±—ä–µ–∫—Ç–æ–≤: ${objectNames.length}</p>
                        <p>–°–≤—è–∑–µ–π: ${model?.model_connections?.length || 0}</p>
                        ${usesLLM ? '<p>‚úÖ LLM —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª –¢–ó –∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª –º–æ–¥–µ–ª—å</p>' : 
                          '<p>‚ö†Ô∏è LLM –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑.</p>'}
                        <button onclick="showDetailedModel()">–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω—É—é –º–æ–¥–µ–ª—å</button>
                        <div id="detailedModel" style="display: none; margin-top: 10px;">
                            <pre>${JSON.stringify(model, null, 2)}</pre>
                        </div>
                    </div>
                `;
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
                
                document.getElementById('detailedTestResult').innerHTML = `
                    <div class="error">
                        <p>‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–æ–¥–µ–ª–∏</p>
                        <p>${error.message}</p>
                        <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:</p>
                        <ul>
                            <li>–ó–∞–ø—É—â–µ–Ω –ª–∏ API —Å–µ—Ä–≤–µ—Ä</li>
                            <li>–î–æ—Å—Ç—É–ø–µ–Ω –ª–∏ –ø–æ—Ä—Ç 5003</li>
                            <li>–ó–∞–ø—É—â–µ–Ω –ª–∏ Ollama (–¥–ª—è LLM —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏)</li>
                        </ul>
                    </div>
                `;
            }
        }
        
        function showDetailedModel() {
            const detailsDiv = document.getElementById('detailedModel');
            detailsDiv.style.display = detailsDiv.style.display === 'none' ? 'block' : 'none';
        }
        
        // –ê–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            log('–°–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è LLM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≥–æ—Ç–æ–≤–∞.');
            log('–ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å LLM" –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.');
        };
    </script>
</body>
</html>