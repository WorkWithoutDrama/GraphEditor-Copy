#!/bin/bash

echo "========================================"
echo "   üöÄ GRAPH EDITOR - –ü–†–û–°–¢–û–ô –ó–ê–ü–£–°–ö"
echo "========================================"
echo ""

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞—Ä—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é —Å—Ç–∞—Ä—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã..."
pkill -f "python.*api_simple_with_cors" 2>/dev/null
pkill -f "node proxy-server" 2>/dev/null
sleep 2

# –ó–∞–ø—É—Å–∫–∞–µ–º API –í –¢–ï–ö–£–©–ï–ú –¢–ï–†–ú–ò–ù–ê–õ–ï (–Ω–µ –≤ —Ñ–æ–Ω–µ)
echo ""
echo "üöÄ –ó–ê–ü–£–°–ö AI API (–ª–æ–≥–∏ –±—É–¥—É—Ç –≤–∏–¥–Ω—ã –ø—Ä—è–º–æ –∑–¥–µ—Å—å):"
echo "========================================"

# –ó–∞–ø—É—Å–∫–∞–µ–º API –≤ —Ç–µ–∫—É—â–µ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
python3 api_simple_with_cors.py &
API_PID=$!

# –ñ–¥–µ–º –∑–∞–ø—É—Å–∫–∞
sleep 5

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Ä—Ç
if [ -f "api_port.txt" ]; then
    API_PORT=$(cat api_port.txt)
    echo ""
    echo "‚úÖ API –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É $API_PORT"
    echo "üì° URL: http://localhost:$API_PORT/api/generate-model"
else
    echo "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ—Ä—Ç API"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–¥–æ—Ä–æ–≤—å–µ API
echo ""
echo "üîç –ü—Ä–æ–≤–µ—Ä—è—é –∑–¥–æ—Ä–æ–≤—å–µ API..."
if curl -s "http://localhost:$API_PORT/api/health" > /dev/null; then
    echo "‚úÖ API –∑–¥–æ—Ä–æ–≤"
else
    echo "‚ùå API –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç"
    exit 1
fi

# –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–∫—Å–∏ –≤ –¥—Ä—É–≥–æ–º –æ–∫–Ω–µ
echo ""
echo "üîß –ó–∞–ø—É—Å–∫–∞—é –ø—Ä–æ–∫—Å–∏ —Å–µ—Ä–≤–µ—Ä (–≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞)..."
echo "   –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–æ–≤—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:"
echo "   cd \"$(pwd)\" && node proxy-server.js"
echo ""
echo "üåê –ó–∞—Ç–µ–º –æ—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä:"
echo "   http://localhost:3000/proxy-index.html"
echo ""
echo "üìù –õ–û–ì–ò API –í –†–ï–ê–õ–¨–ù–û–ú –í–†–ï–ú–ï–ù–ò:"
echo "========================================"
echo "JSON –º–æ–¥–µ–ª–∏ –±—É–¥–µ—Ç –≤—ã–≤–æ–¥–∏—Ç—å—Å—è –ø—Ä—è–º–æ –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏!"
echo ""
echo "üõë –î–õ–Ø –û–°–¢–ê–ù–û–í–ö–ò: –Ω–∞–∂–º–∏—Ç–µ Ctrl+C –≤ —ç—Ç–æ–º –æ–∫–Ω–µ"

# –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è API
wait $API_PID